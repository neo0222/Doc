test
## レイヤー3

### 概要
- レイヤー3は、ネットワーク間の、インターネットワークでの接続を担当する。
  - インターネットワーク：全世界をつないでいるネットワーク
- 膨大なトラフィックを制御するため、小さなネットワークに細分化する必要がある。
- レイヤー3は論理アドレスを使う。
  - どこに、何があるかを表すアドレス
- 論理アドレスを使って、経由するネットワークを探索する（ルーティング）
- ルータがネットワーク間を接続する。
- ルータは最適な経路を選択し、スイッチングを行う。
- ルータがなければネットワーク間の接続は行えない。


### インタ―ネットプロトコル（IP)
- インターネットでは**TCP/IP**プロトコルを用いる。
  1. 論理アドレス（どこに、何があるかの情報）を決定する
  1. 経路を設定する
  1. 転送（コネクションレス型通信）
- TCP/IPプロトコルは複数のプロトコルの集合体である。
- レイヤ3のデータ転送を行うのはIPである。
- IPのカプセル化にはセグメントにIPヘッダをつける。
- 送信元と宛先のアドレスがある。

### IPアドレス
- IPアドレスは**ネットワーク管理者**が**各デバイス**の**ネットワークとの接続点**ごとにつける。
- 論理アドレスは、所属するネットワークの番号＋ホストの番号という形式 i.e. どこのだれ。
  - ネットワーク番号：接続されているすべてのネットワークでユニークでなきゃいけない。
  - ホスト番号：所属するネットワーク内でユニークでなきゃいけない。
  - 場所が変わるとアドレスも変わる
- IPアドレスは32ビット

### クラスフルアドレッシング
- インターネット内のすべてのネットワークはユニークでなければいけないので、統括的なネットワーク管理者が必要→ICANN
- ICANNが考えたポリシーに基づいて論理アドレスを割り振る。割り振るのは国ごとに存在するNIC(Network Information Center)。
- クラス：ICANNが用いる、インターネットのIPアドレスを管理するための概念。
-
- 予約済みアドレス：
  - XXX.YYY.ZZZ.0：ネットワーク自体に届ける
  - XXX.YYY.ZZZ.255：すべてのポストが受け取る

### サブネッティング
- プライベートIPアドレス
  - 予約済IPアドレス
  - インターネットに接続しない環境で使われるアドレス
  - 万が一接続できるようになっても、ルータがインターネット上に情報を流さないように止める。
  |第１オクテット | 第２オクテット	|第３オクテット	|第４オクテット|
  |---|---|---|---|
|10 |	ホスト番号|	ホスト番号|	ホスト番号|
|172 |16～31 |ホスト番号 |ホスト番号 |
192	|168 |0～255	|ホスト番号|

### アドレス4種
- データ転送をする場合、宛先IPアドレス、宛先MACアドレス、送信元IPアドレス、送信元MACアドレスの４つのアドレスが必須。
- 送信元MACアドレス＝自分のMACアドレスは、NICを取り付けた段階でわかる。
- 送信元IPアドレス＝自分のIPアドレスは、静的な割り当てと、動的な割り当てがある。
- 静的な割り当ては、ネットワーク管理者にIPアドレスを割り当ててもらい、手動で入力する。
- サーバと通信して、IPアドレスを割り当ててもらう方式を動的な割り当てという。
- 動的な割り当てには、RARP、BOOTP、DHCPなどがある。

### DHCP
- IPアドレスを自動的に割り振る方法がDHCPである。
- 各クライアントはDHCPサーバが持つアドレスプールから、IPアドレスを割り振ってもらう。
- IPアドレスを割り振る際には、リース期間を設定する。
- DHCPはIPアドレスを割り振るだけでなく、詳細な設定も同時に送信することができる。
- DHCPの動作は、以下のように行われる。
  - クライアントがサーバを見つける(DISCOVER)
  - サーバは候補のアドレスを送る(OFFER)
  - クライアントは正式な要求を送る(REQUEST)
  - サーバがそれを認める(ACK)
- DHCPのメッセージのやりとりはブロードキャストを使用する。
- リース期間前にも返却や再取得要求が行える。

### ARP
- ARP：DNSを用いて取得したIPアドレスに紐づくホストから、そのホストのMACアドレスを取得するプロトコル
- MACアドレスを取得する際にはARPテーブルを利用する。
- ARPテーブルは一定時間でクリアされる。
- ARPのデータ転送には、ARPパケットを使い、それをブロードキャストする。

### ルータ

![img](http://www^.biglobe.ne.jp/aji/3min/img/router2.gif)

- ルータもポートを持っている
- ハブやブリッジと違い、論理アドレスを持ち、パケットを受け取って送り出す。
  - ルータのポートは各ネットワークに所属する形になる。
  - データ転送は同じネットワーク内でしか行えないから。
- ルータはルーティングテーブル（最適なルートの地図）を持っている。

### デフォルトゲートウェイ
- ルータはブロードキャストドメイン（データが届く範囲）を分けることができる i.e. ブロードキャストを他のネットワークに送り出さない。
  - but 宛先のMACアドレスを知るためのARP自体がブロードキャストなので、このままだと困る。
- デフォルトゲートウェイ：ルータが担う。他のネットワークにデータ転送をする際にいったん受け取る人のこと。ネットワークの接続点になる。
  - 一旦自身のMACアドレスをARPで返すことでブロードキャストの問題を解消できる。

### ルーティングテーブル
- 宛先、中継地点、距離、宛先への出口、からなる。
- ルータは、宛先IPアドレスとサブネットマスクから宛先ネットワークアドレスを決定する。
- ルーティングテーブルに宛先がない場合、宛先不明としてパケット破棄。

### ルーティング
- ルーティングテーブルを作るため、ルータは他ネットワークへのルートを知る必要がある。
- 知る方法は、静的ルーティングと動的ルーティングがある。
- 静的ルーティングは管理者が手動で入力する。
  - 静的ルートは最優先される。
  - デフォルトルートも静的ルートである。
- 動的ルーティングは自動でルート情報を交換しあう。
  - 交換し合った情報から最適なルートを選択する。
  - 障害が起きても切り離すことが可能である。
  - 帯域幅や処理能力を必要とする。
  - コンバージェンスである必要がある。
  - ルーティングプロトコルで実現される。

### ルーティングプロトコル
#### 前提知識
- ルーティング対象プロトコル：ルートを決定する際の情報をもつプロトコル i.e. 論理アドレスを提供し、実際にデータを転送するプロトコルのこと。
- 自律システム（AS)：管理組織（プロバイダとか）ごとに複数のネットワークをまとめたもの。
  - ASにはAS番号が付けられているbyICANN
#### 本題
- ルーティングプロトコルには
  - AS間のルーティング用：EGP
  - AS内部のルーティング用：IGP
がある。
- 近接ルータ間とネットワークの情報を交換しあう。
  - いつ、どうやって、誰に、何を送るのかをルーティングプロトコルが決定する。
- コンバージェンスに達する必要がある。
- 最適ルートをルーティングテーブルに載せる。
- 最適ルートはメトリックにより決定する。
  - ホップ数、回線のスピード、混み具合、エラー率などが基準となる。

### RIP
// TODO あとで

### ICMP
// TODO あとで

## レイヤー4
### 概要
